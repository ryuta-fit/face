# 自律神経評価アルゴリズム ドキュメント

## 概要
このシステムは、MediaPipe Face Meshで取得した468点の顔面ランドマークから、顔面筋の緊張度を分析し、自律神経（交感神経・副交感神経）のバランスを評価します。

## 評価指標

### 1. 筋緊張度メトリクス

#### 前頭部緊張度 (Forehead Tension)
- **測定ポイント**: 9, 10, 151, 337, 299, 333, 298, 301
- **計算方法**: ポイント間距離の平均値
- **正規化範囲**: 0.3 - 0.7

#### 眉間緊張度 (Eyebrow Tension) ⭐最重要
- **測定ポイント**: 
  - 左眉: 70, 63, 105, 66, 107
  - 右眉: 300, 293, 334, 296, 336
- **計算方法**: 眉の高さの平均（低いほど緊張）
- **正規化範囲**: 0.3 - 0.7

#### 目の緊張度 (Eye Tension)
- **測定ポイント**:
  - 左目上: 159, 158, 157, 173
  - 左目下: 145, 144, 163, 7
  - 右目上: 386, 385, 384, 398
  - 右目下: 374, 373, 390, 249
- **計算方法**: 目の開き具合（上下瞼間距離）
- **正規化範囲**: 0 - 1

#### 頬緊張度 (Cheek Tension)
- **測定ポイント**:
  - 左頬: 35, 31, 228, 229, 230
  - 右頬: 264, 102, 415, 308, 292
- **計算方法**: 頬のポイント間距離
- **正規化範囲**: 0.3 - 0.7

#### 口元緊張度 (Mouth Tension)
- **測定ポイント**:
  - 上唇: 61, 62, 63, 64, 65
  - 下唇: 78, 79, 80, 81, 82
- **計算方法**: 口の縦横比率
- **正規化範囲**: 0 - 1

#### 顎緊張度 (Jaw Tension)
- **測定ポイント**: 172, 136, 150, 149, 176, 148, 152, 377
- **計算方法**: 顎ラインの角度変化
- **正規化範囲**: 0 - 1

#### 顔面非対称性 (Facial Asymmetry)
- **測定ポイント**: 左右対称ポイントのペア
  - 目頭: 33/263
  - 口角: 61/291
  - 眉頭: 70/300
  - 顎: 172/397
- **計算方法**: 左右の距離差の平均

#### 瞬き率 (Blink Rate)
- **測定方法**: 目の開閉状態の変化を検出
- **正常範囲**: 10-25回/分

## 自律神経評価アルゴリズム

### 交感神経スコア計算

```
交感神経スコア = 
  前頭部緊張度 × 0.15 +
  眉間緊張度 × 0.40 +    // 最も重要な指標
  目の緊張度 × 0.20 +
  顎緊張度 × 0.10 +
  非対称性 × 0.10 +
  瞬き率異常 × 0.05
```

### 副交感神経スコア計算

```
副交感神経スコア = 
  (1 - 前頭部緊張度) × 0.20 +
  (1 - 目の緊張度) × 0.25 +
  (1 - 顎緊張度) × 0.25 +
  (1 - 頬緊張度) × 0.15 +
  (1 - 瞬き率異常) × 0.15
```

### スコアの正規化

```
合計 = 交感神経スコア + 副交感神経スコア
交感神経比率 = (交感神経スコア / 合計) × 100
副交感神経比率 = (副交感神経スコア / 合計) × 100
```

## 診断基準

### 自律神経バランス状態

1. **交感神経優位** (>65%)
   - ストレス・緊張状態
   - 眉間・目・顎の緊張が高い
   - 推奨：リラックス法、深呼吸

2. **副交感神経優位** (>65%)
   - リラックス状態
   - 全体的に筋緊張が低い
   - 推奨：適度な活動性の維持

3. **バランス状態** (35-65%)
   - 理想的な自律神経バランス
   - 健康的な状態

### 個別症状の閾値

- **高い目の緊張**: >0.7
- **高い顎の緊張**: >0.7
- **高い非対称性**: >0.7
- **異常な瞬き率**: <0.3 または >0.7

## 信頼度評価

信頼度は以下の要因で低下します：

1. **極端な値** (< 0.1 または > 0.9): ×0.8
2. **高いデータ分散** (分散 > 0.2): ×0.7

信頼度レベル：
- **高**: >0.7
- **中**: 0.4-0.7
- **低**: <0.4

## 重み付けの根拠

### 交感神経指標の重み
- **眉間緊張 (40%)**: ストレス時に最も顕著に現れる
- **目の緊張 (20%)**: 集中・緊張状態を反映
- **前頭部緊張 (15%)**: 全体的な緊張状態
- **顎緊張 (10%)**: 無意識の緊張
- **非対称性 (10%)**: ストレスによる表情の歪み
- **瞬き率異常 (5%)**: 補助的指標

### 副交感神経指標の重み
- **目のリラックス (25%)**: リラックス状態の主要指標
- **顎のリラックス (25%)**: 無意識レベルのリラックス
- **前頭部リラックス (20%)**: 全体的なリラックス
- **頬のリラックス (15%)**: 表情筋のリラックス
- **正常瞬き率 (15%)**: 自然な状態

## 使用方法

```javascript
// アルゴリズムのインスタンス化
const evaluator = new AutonomicEvaluationAlgorithm();

// 筋緊張メトリクスの入力
const muscleMetrics = {
    foreheadTension: 0.6,
    eyebrowTension: 0.7,
    eyeTension: 0.5,
    cheekTension: 0.4,
    mouthTension: 0.5,
    jawTension: 0.6,
    asymmetry: 0.3,
    blinkRate: 0.5
};

// 評価実行
const result = evaluator.evaluateAutonomicState(muscleMetrics);

// 結果
// {
//   sympathetic: 58,        // 交感神経優位度 (%)
//   parasympathetic: 42,    // 副交感神経優位度 (%)
//   diagnosis: "...",       // 診断メッセージ
//   confidence: 0.85,       // 信頼度
//   dominantSystem: "balanced"  // 優位なシステム
// }
```

## カスタマイズ

### 重み付けの変更
```javascript
evaluator.updateWeights({
    sympathetic: {
        eyebrowTension: 0.5  // 眉間の重要度を上げる
    }
});
```

### 閾値の変更
```javascript
evaluator.updateThresholds({
    sympatheticDominant: 70  // より厳しい基準に
});
```

## 今後の改善案

1. **個人差の考慮**
   - ベースライン学習機能
   - 個人プロファイルの保存

2. **時系列分析**
   - 変化のトレンド検出
   - 長期的なパターン分析

3. **環境要因の考慮**
   - 照明条件の補正
   - カメラ角度の補正

4. **追加の生体指標**
   - 心拍変動との相関
   - 呼吸パターンの検出